<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PhotoSphereViewer - equirectangular tiles demo</title>

  <link rel="stylesheet" href="../dist/photo-sphere-viewer.css">

  <style>
    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      margin: 0;
      padding: 0;
    }

    #photosphere {
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body>

<div id="photosphere"></div>

<script src="../node_modules/three/build/three.js"></script>
<script src="../node_modules/promise-polyfill/dist/polyfill.js"></script>
<script src="../node_modules/uevent/browser.js"></script>
<script src="../dist/photo-sphere-viewer.js"></script>
<script src="../dist/adapters/equirectangular-tiles.js"></script>

<script>
  let viewer;

  generateBaseUrl('sphere_small.jpg')
    .then(baseUrl => {
      viewer = new PhotoSphereViewer.Viewer({
        container : 'photosphere',
        adapter   : [PhotoSphereViewer.EquirectangularTilesAdapter, {
          showErrorTile: true,
        }],
        panorama  : {
          width  : 6656,
          cols   : 16,
          rows   : 8,
          baseUrl: baseUrl,
          tileUrl: (col, row) => {
            if (col === 8 && row === 4) {
              return 'error.jpg';
            }
            const num = row * 16 + col + 1;
            return `sphere-tiles/image_part_${('000' + num).slice(-3)}.jpg`;
          },
        },
        loadingImg: 'assets/photosphere-logo.gif',
        navbar             : [
          'autorotate', 'zoom',
          {
            id: 'custom',
            title    : 'Change image',
            className: 'custom-button',
            content  : 'ðŸ”„',
            onClick  : () => {
              viewer.navbar.getButton('custom').disable();

              viewer.setPanorama({
                width  : 6656,
                cols   : 16,
                rows   : 8,
                tileUrl: () => {
                  const num = Math.ceil(Math.random() * 128);
                  return `sphere-tiles/image_part_${('000' + num).slice(-3)}.jpg`;
                },
              });
            },
          },
          'caption', 'fullscreen',
        ],
      })
    });

  // for demonstration purpose only
  function generateBaseUrl(url) {
    const loader = new THREE.ImageLoader();

    return new Promise((resolve, reject) => loader.load(url, resolve, undefined, reject))
      .then(image => {
        const canvas = document.createElement('canvas');
        canvas.width = image.width;
        canvas.height = image.height;

        const ctx = canvas.getContext('2d');
        ctx.drawImage(image, 0, 0);
        ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        return canvas.toDataURL('image/png');
      });
  }
</script>
</body>
</html>
